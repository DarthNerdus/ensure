#!/bin/sh

set -e
[ -n "$DEBUG" ] && set -x

PATH="$PATH:$(dirname $0)/../libexec/ensure"

ENSURE_VERBOSE=0;
while getopts "v" opt; do
  case $opt in
    v)
      ENSURE_VERBOSE=$((ENSURE_VERBOSE+1));
      ;;
  esac
done

shift $((OPTIND-1));

CMD="$1";

if [ -n "$CMD" ]; then
  shift
else
  CMD="install"
fi

export ENSURE_DIR="${ENSURE_DIR:-"$HOME/.ensure"}"
export ENSURE_LIB="$(dirname "$0")/../lib/ensure"
export ENSURE_MANIFEST="${ENSURE_MANIFEST:-"$ENSURE_DIR/manifest"}"
export ENSURE_VERBOSE;

source "$ENSURE_LIB/helpers.sh"

if ! command -v "ensure-$CMD" &>/dev/null; then
  abort "Can't find \`$CMD\`. Make sure \`ensure-$CMD\` is in your PATH."
fi

log_debug "Starting $(abspath `command -v "ensure-$CMD"`) $@"
ensure-$CMD $@
log_debug "Finished $(abspath `command -v "ensure-$CMD"`) $@"
